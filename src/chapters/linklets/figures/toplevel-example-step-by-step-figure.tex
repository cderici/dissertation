\begin{figure}[htbp]
  \centering
  \renewcommand{\arraystretch}{1.4}
  \setlength{\tabcolsep}{5pt}
  \begin{tabular}{
    >{\centering\arraybackslash}m{0.30\textwidth}
    >{\centering\arraybackslash}m{0.30\textwidth}
    >{\centering\arraybackslash}m{0.13\textwidth}
    >{\centering\arraybackslash}m{0.16\textwidth}
  }
    % --- Header row ---
    \begin{tabular}{@{}c@{}}
      \textbf{(a) Linklet} \\[-2pt]
      generated by expand
    \end{tabular}
    &
    \begin{tabular}{@{}c@{}}
      \textbf{(b) Linklet} \\[-2pt]
      compiled by VM
    \end{tabular}
    &
    \begin{tabular}{@{}c@{}}
      \textbf{(c) Env} \\[-2pt]
      post-comp
    \end{tabular}
    &
    \begin{tabular}{@{}c@{}}
      \textbf{(d) Target} \\[-2pt]
      post-inst
    \end{tabular}
    \\
    \hline\hline

    % --- Row 1 ---
    \multicolumn{4}{l}{\textbf{\texttt{> (define k (lambda () a))}}} \\
    \begin{lstlisting}[language=racket,basicstyle=\ttfamily\footnotesize,frame=none,numbers=none,aboveskip=1pt,belowskip=1pt,columns=flexible]

(linklet (...) (a k)
  (define-values (k)
    (lambda () a)))
    \end{lstlisting}
    &
    \begin{lstlisting}[language=racket,basicstyle=\ttfamily\footnotesize,frame=none,numbers=none,aboveskip=1pt,belowskip=1pt,columns=flexible]

(linklet (...)
         ((a0 a) (k0 k))
  (define-values (k)
    (lambda ()
      (variable-ref
        (LinkletVar a0))))
  (variable-set!
    (LinkletVar k0) k))
    \end{lstlisting}
    &
    \(
      \begin{array}{l}
        a_0 \rightarrow \text{var}_a \\
        k_0 \rightarrow \text{var}_k
      \end{array}
    \)
    &
    \(
      \begin{array}{l}
        a \rightarrow \text{var}_a \\
        k \rightarrow \text{var}_k
      \end{array}
    \) \\
    \hline

    % --- Row 2 ---
    \multicolumn{4}{l}{\textbf{\texttt{> (define a 10)}}} \\
    \begin{lstlisting}[language=racket,basicstyle=\ttfamily\footnotesize,frame=none,numbers=none,aboveskip=1pt,belowskip=1pt,columns=flexible]
(linklet (...) (a)
  (define-values (a) 10))
    \end{lstlisting}
    &
    \begin{lstlisting}[language=racket,basicstyle=\ttfamily\footnotesize,frame=none,numbers=none,aboveskip=1pt,belowskip=1pt,columns=flexible]
(linklet (...) ((a1 a))
  (define-values (a) 10)
  (variable-set!
    (LinkletVar a1) a))
    \end{lstlisting}
    &
    \(
      a_1 \rightarrow \text{var}_a
    \)
    &
    \(
      \begin{array}{l}
        a \rightarrow \text{var}_a \\
        k \rightarrow \text{var}_k
      \end{array}
    \) \\
    \hline

    % --- Row 3 ---
    \multicolumn{4}{l}{\textbf{\texttt{> (k)}}} \\
    \begin{lstlisting}[language=racket,basicstyle=\ttfamily\footnotesize,frame=none,numbers=none,aboveskip=1pt,belowskip=1pt,columns=flexible]
(linklet (...) (k) (k))
    \end{lstlisting}
    &
    \begin{lstlisting}[language=racket,basicstyle=\ttfamily\footnotesize,frame=none,numbers=none,aboveskip=1pt,belowskip=1pt,columns=flexible]
(linklet (...) ((k1 k))
  ((variable-ref
     (LinkletVar k1))))
    \end{lstlisting}
    &
    \(
      k_1 \rightarrow \text{var}_k
    \)
    &
    \(
      \begin{array}{l}
        a \rightarrow \text{var}_a \\
        k \rightarrow \text{var}_k
      \end{array}
    \) \\

    \hline

\end{tabular}
  \caption{Internal steps in linklet instantiations for step-by-step Top-level REPL interactions.}
  \label{fig:topevel-example-step-by-step}
\end{figure}
