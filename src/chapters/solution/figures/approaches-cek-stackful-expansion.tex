\begin{figure}[ht]
  \centering
  \begin{tikzpicture}
  \begin{axis}[
    ybar,
    bar width=3pt,
    width=15cm,
    height=8cm,
    ymode=log,
    log basis y=10,
    scaled y ticks=false,
    ylabel={Runtime (ms, log scale)},
    symbolic x coords={
      string,sumloop,sumfp,fft,mbrot,ctak,pnpoly,sum,fibfp,pi,triangl,array1,
      simplex,puzzle,primes,diviter,fib,nqueens,takl,cpstak,gcold,ack,gcbench,
      graphs,divrec,mazefun,sboyer,tak,perm9,nboyer,earley,paraffins,,g. mean},
    xtick=data,
    xticklabel style={rotate=55,anchor=east,font=\scriptsize},
    enlarge x limits=0.06,
    ymajorgrids=true,
    grid style=dashed,
    legend style={
        at={(0.5,1.08)},
        anchor=south,
        legend columns=3,
        column sep=8pt,
        draw=none,
        fill=none,
        font=\small,
        /tikz/column 2/.style={anchor=west},
    },
    legend image code/.code={\draw[#1,fill=#1] (-0.15cm,-0.10cm) rectangle (0.15cm,0.10cm);},
  ]

  %────────────────────────  Vanilla Pycket (CEK-only)  ────────────────────────
  \addplot[
    ybar,
    fill=gray!20,
    draw=black,
    bar shift=+4pt,
    error bars/.cd, y dir=both, y explicit,
  ] coordinates {
    (string,2609)     +- (0,97.68)
    (sumloop,1878)    +- (0,68.15)
    (sumfp,1078)      +- (0,122.32)
    (fft,8008)        +- (0,275.71)
    (mbrot,4228)      +- (0,179.65)
    (ctak,2316)       +- (0,134.85)
    (pnpoly,5668)     +- (0,187.85)
    (sum,1176)        +- (0,121.88)
    (fibfp,1279)      +- (0,129.59)
    (pi,10137)        +- (0,386.88)
    (triangl,3694)    +- (0,165.33)
    (array1,3278)     +- (0,102.17)
    (simplex,14105)   +- (0,458.38)
    (puzzle,10684)    +- (0,350.35)
    (primes,2327)     +- (0,157.48)
    (diviter,1643)    +- (0,124.55)
    (fib,1280)        +- (0,137.37)
    (nqueens,3516)    +- (0,171.67)
    (takl,2508)       +- (0,167.17)
    (cpstak,1485)     +- (0,74.69)
    (gcold,24044)     +- (0,3362.14)
    (ack,1367)        +- (0,71.07)
    (gcbench,7699)    +- (0,306.06)
    (graphs,14249)    +- (0,409.29)
    (divrec,1276)     +- (0,126.86)
    (mazefun,10152)   +- (0,382.54)
    (sboyer,14821)    +- (0,644.38)
    (tak,1177)        +- (0,131.35)
    (perm9,4229)      +- (0,195.00)
    (nboyer,14576)    +- (0,865.64)
    (earley,18704)    +- (0,996.70)
    (paraffins,7313)  +- (0,266.17)
    % spacer (no coordinate)
    (g. mean,4060)    +- (0,0)
  };

  %──────────────  Pycket with hybrid model (CEK + Stackful)  ────────────────
  \addplot[
    ybar,
    fill=gray!50,
    draw=black,
    bar shift=0pt,
    error bars/.cd, y dir=both, y explicit,
  ] coordinates {
    (string,234800)   +- (0,14088.00)
    (sumloop,159600)  +- (0,8778.00)
    (sumfp,86200)     +- (0,5172.00)
    (fft,760700)      +- (0,38035.00)
    (mbrot,389000)    +- (0,27230.00)
    (ctak,203808)     +- (0,12228.48)
    (pnpoly,510100)   +- (0,30606.00)
    (sum,94080)       +- (0,5174.40)
    (fibfp,104878)    +- (0,6292.68)
    (pi,942700)       +- (0,61275.50)
    (triangl,332500)  +- (0,18287.50)
    (array1,278600)   +- (0,15323.00)
    (simplex,1551500) +- (0,77575.00)
    (puzzle,940192)   +- (0,56411.52)
    (primes,195468)   +- (0,11728.08)
    (diviter,134726)  +- (0,8083.56)
    (fib,99800)       +- (0,5489.00)
    (nqueens,337536)  +- (0,18564.48)
    (takl,208164)     +- (0,12489.84)
    (cpstak,127710)   +- (0,7662.60)
    (gcold,2764060)   +- (0,124380.00)
    (ack,120296)      +- (0,7217.76)
    (gcbench,677512)  +- (0,40650.72)
    (graphs,1496145)  +- (0,82288.00)
    (divrec,108460)   +- (0,6507.60)
    (mazefun,964440)  +- (0,57866.40)
    (sboyer,1660000)  +- (0,87980.00)
    (tak,96514)       +- (0,5308.27)
    (perm9,359465)    +- (0,21567.90)
    (nboyer,1676240)  +- (0,92193.20)
    (earley,2020032)  +- (0,111101.76)
    (paraffins,672796) +- (0,33639.80)
    % spacer (no coordinate)
    (g. mean,356000)  +- (0,0.00)
  };

  %────────────────────────────  Racket 8.18  ────────────────────────────
  \addplot[
    ybar,
    fill=gray!80,
    draw=black,
    bar shift=-4pt,
    error bars/.cd, y dir=both, y explicit,
  ] coordinates {
    (string,65)     +- (0,0.77)
    (sumloop,58)    +- (0,0.79)
    (sumfp,73)      +- (0,3.88)
    (fft,132)       +- (0,3.75)
    (mbrot,104)     +- (0,3.63)
    (ctak,84)       +- (0,3.86)
    (pnpoly,98)     +- (0,3.73)
    (sum,70)        +- (0,3.60)
    (fibfp,73)      +- (0,3.75)
    (pi,159)        +- (0,4.06)
    (triangl,104)   +- (0,3.70)
    (array1,70)     +- (0,0.88)
    (simplex,288)   +- (0,4.18)
    (puzzle,201)    +- (0,4.53)
    (primes,83)     +- (0,3.84)
    (diviter,77)    +- (0,4.08)
    (fib,76)        +- (0,3.64)
    (nqueens,92)    +- (0,3.57)
    (takl,85)       +- (0,3.41)
    (cpstak,47)     +- (0,1.34)
    (gcold,420)     +- (0,4.32)
    (ack,58)        +- (0,0.79)
    (gcbench,148)   +- (0,3.91)
    (graphs,234)    +- (0,3.70)
    (divrec,83)     +- (0,3.63)
    (mazefun,187)   +- (0,3.94)
    (sboyer,214)    +- (0,3.90)
    (tak,74)        +- (0,3.70)
    (perm9,102)     +- (0,4.09)
    (nboyer,211)    +- (0,3.75)
    (earley,451)    +- (0,5.25)
    (paraffins,164) +- (0,3.95)
    % spacer (no coordinate)
    (g. mean,114)   +- (0,0)
  };

  \legend{Vanilla Pycket, Pycket with hybrid model, Racket 8.18}
  \end{axis}
  \end{tikzpicture}
  \caption{Program-expansion performance. Vanilla self-hosting CEK-only Pycket vs Pycket with CEK \& Stackful hybrid model vs.\ Racket~8.18 --- lower is better.}
  \label{fig:crossbenchmark-expansion-times-vs-R-hybrid-model}
\end{figure}
