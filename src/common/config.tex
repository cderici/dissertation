%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Prevent abstract to clearpage after title
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\makeatletter
\renewenvironment{abstract}
  {\section*{}     % no clearpage, just a heading
   }
  {}
\makeatother


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Trying to prevent \part to automatically clearpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% % keep \part inline (no automatic clearpages)
% \titleclass{\part}{straight}
% \titleformat{\part}[block]{\centering\Large\bfseries}
%             {\partname~\thepart}{1ex}{}
% \titlespacing*{\part}{0pt}{2\baselineskip}{\baselineskip}

% % define inline-chapter   ——>  same page as preceding part
% \titleclass{\ichapter}{straight}[\chapter]   % establish a new heading name
% \makeatletter
% \newcommand{\inlinechapter}[1]{%
%   \titleclass{\chapter}{straight}%  locally kill clearpage
%   \chapter{#1}%
%   \titleclass{\chapter}{top}[\part]% restore normal behaviour
% }
% \makeatother


\lstset{
  % --- Linenos ---
  numbersep=20pt,                  % how far the line-numbers are from the code
  numberstyle=\small\color{gray},
  numbers=left,                   % where to put the line-numbers
  stepnumber=1,                   % the step between two line-numbers. If it is 1 each line will be numbered
  % -- Basics --
  basicstyle=\ttfamily,
  sensitive=true,  % Case-sensitive keywords
  tabsize=2,
  breaklines=true,  % Break lines if too long
  %escapechar=`,
  %escapeinside={<@}{@>},
  % I don't know what keepspaces and columns do, but together, they fix the ugly default listings style.
  columns=fullflexible,
  keepspaces,
  showstringspaces=false,  % Spaces not shown as _
  frame            = single,
  framerule        = 0.5pt,
  rulecolor        = \color{black},
  framesep         = 10pt,
  framexleftmargin = 0pt,
  framexrightmargin= 0pt,
}

\definecolor{ForestGreen}{RGB}{64,139,64}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% NUMBERLESS style for tables etc.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\lstdefinestyle{numberless}{
  basicstyle=\ttfamily\scriptsize,
  numbers=none,
  mathescape=true,
  columns=fullflexible,
  breaklines=true,
  showstringspaces=false
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% RPython TRACE
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\lstdefinestyle{rptrace-style}{
  language=rptrace,
  numbers=none,
  numbersep=-5pt,
  numberstyle=\scriptsize\ttfamily\color{gray},
  basicstyle=\scriptsize\ttfamily,
  sensitive=true,
  tabsize=2,
  breaklines=true,
  columns=fullflexible,
  keepspaces,
  showstringspaces=false,
  frame=single,
  framerule=0.5pt,
  rulecolor=\color{black},
  framesep=10pt,
  framexleftmargin=0pt,
  framexrightmargin=0pt
}

\lstdefinestyle{python-style}{
  language=Python,
  numbers=right,
  numbersep=-5pt,
  numberstyle=\scriptsize\ttfamily\color{black},
  basicstyle=\scriptsize\ttfamily,
  sensitive=true,
  tabsize=2,
  breaklines=true,
  columns=fullflexible,
  keepspaces,
  showstringspaces=false,
  frame=single,
  framerule=0.5pt,
  rulecolor=\color{black},
  framesep=10pt,
  framexleftmargin=0pt,
  framexrightmargin=0pt,
  keywordstyle=\bfseries,
  commentstyle=\itshape,
  morekeywords=[2]{JitDriver, jit_merge_point, can_enter_jit},
}


\lstdefinelanguage{rptrace}{
  morecomment=[l]{\#},
  morestring=[b]",
  commentstyle={\color{ForestGreen}\slshape\sffamily},
  sensitive=false,
  keywords={
      int_add, int_eq, int_lt, strgetitem,
      getfield_gc_r, getfield_gc_i
  },
  classoffset=1,
    morekeywords={
      guard_true, guard_false,
    },
    keywordstyle=\color{red},
  classoffset=2,
    morekeywords={
      label, jump,
    },
    keywordstyle=\color{blue},
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% RACKET lang
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\lstdefinelanguage{racket} {
  % -- Comments --
  %morecomment=[l]{//},
  %morecomment=[s]{/*}{*/},
  morecomment=[l]{;},         % Inline comments start with ;
  morecomment=[s]{\#|}{|\#},  % Block comments are done with #|  |#
  commentstyle={\color{ForestGreen}\slshape\sffamily},
  % -- Strings --
  morestring=[b]",
  stringstyle=\color{red},
  % --- Literal replacements ---
  literate=%
  %	{lambda}{{$\lambda$}}1
    {->}{{$\rightarrow$}}1
    {*}{{$\times$}}1,
  % -- Keywords (I got these from a vague French website; Racket seems to have no lstlisting style defined anywhere) --
  classoffset=1,
    morekeywords={
      define, define-syntax, define-macro, define-datatype, lambda, define-stream, stream-lambda
    },
    keywordstyle=\color{blue},
  classoffset=2,
    morekeywords={
      begin, call-with-current-continuation, call/cc, call-with-input-file, call-with-output-file,
      cases, cond, do, else, for, time, for-each, if,
      let*, let, let-syntax, letrec, letrec-syntax,
      define-context, define-controller, Integer, Boolean, get, when-required, when-provided,
      maybe_publish, require, submod, or/c, ->, \#\%module-begin, always_publish, with-syntax, define-struct/contract, syntax-case, define/contract,
      let-values, let*-values,
      module, provide,
      and, or, not,
      delay, force, in-range, regexp-match,
      \#`, \#',
      null, cons, car, cdr, cadr, caddr,
      \#lang, implement, begin-for-syntax, rename-out,
      quasiquote, quote, unquote, unquote-splicing,
      map, filter, foldl, syntax, syntax-rules, eval, environment, query
    },
    keywordstyle=\color{blue},
  classoffset=3,
    morekeywords={import, export},
    keywordstyle=\color{green},
  classoffset=0,
  alsoletter={',`,-,/,>,<,\#,\%},
  moredelim=**[is][\color{lightgray}]{<<@<<}{>>@>>},
  moredelim=**[is][\itshape\color{OliveGreen}]{<<;<<}{>>;>>},
}

